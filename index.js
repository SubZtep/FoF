const i={once:THREE.LoopOnce,repeat:THREE.LoopRepeat,pingpong:THREE.LoopPingPong};AFRAME.registerComponent("animation-mixer",{schema:{clip:{default:"*"},duration:{default:0},clampWhenFinished:{default:!1,type:"boolean"},crossFadeDuration:{default:0},loop:{default:"repeat",oneOf:Object.keys(i)},repetitions:{default:1/0,min:0},timeScale:{default:1}},init:function(){this.model=null,this.mixer=null,this.activeActions=[];const i=this.el.getObject3D("mesh");i?this.load(i):this.el.addEventListener("model-loaded",(i=>{this.load(i.detail.model)}))},load:function(i){const t=this.el;this.model=i,this.mixer=new THREE.AnimationMixer(i),this.mixer.addEventListener("loop",(i=>{t.emit("animation-loop",{action:i.action,loopDelta:i.loopDelta})})),this.mixer.addEventListener("finished",(i=>{t.emit("animation-finished",{action:i.action,direction:i.direction})})),this.data.clip&&this.update({})},remove:function(){this.mixer&&this.mixer.stopAllAction()},update:function(t){if(!t)return;const e=this.data,n=AFRAME.utils.diff(e,t);if("clip"in n)return this.stopAction(),void(e.clip&&this.playAction());this.activeActions.forEach((t=>{"duration"in n&&e.duration&&t.setDuration(e.duration),"clampWhenFinished"in n&&(t.clampWhenFinished=e.clampWhenFinished),("loop"in n||"repetitions"in n)&&t.setLoop(i[e.loop],e.repetitions),"timeScale"in n&&t.setEffectiveTimeScale(e.timeScale)}))},stopAction:function(){const i=this.data;for(let t=0;t<this.activeActions.length;t++)i.crossFadeDuration?this.activeActions[t].fadeOut(i.crossFadeDuration):this.activeActions[t].stop();this.activeActions.length=0},playAction:function(){if(!this.mixer)return;const e=this.model,n=this.data,o=e.animations||(e.geometry||{}).animations||[];if(!o.length)return;const a=(s=n.clip,new RegExp("^"+s.split(/\*+/).map(t).join(".*")+"$"));var s;for(let t,s=0;t=o[s];s++)if(t.name.match(a)){const o=this.mixer.clipAction(t,e);o.enabled=!0,o.clampWhenFinished=n.clampWhenFinished,n.duration&&o.setDuration(n.duration),1!==n.timeScale&&o.setEffectiveTimeScale(n.timeScale),o.setLoop(i[n.loop],n.repetitions).fadeIn(n.crossFadeDuration).play(),this.activeActions.push(o)}},tick:function(i,t){this.mixer&&!isNaN(t)&&this.mixer.update(t/1e3)}});function t(i){return i.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}AFRAME.registerSystem("sketch",{schema:{box:{type:"selector",default:".box"}},init(){}});
